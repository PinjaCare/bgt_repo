{% extends "base.html" %}

{% block title %}Games | BoardGameTracker{% endblock %}
{% block container_class %}page-container wide{% endblock %}

{% block body %}

<div class="games-header mb-4">
    <h1 class="mb-0">Games</h1>

    <button
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#addGameModal">
        <i class="bi bi-plus-circle-fill"></i>
        Add game
    </button>
</div>

<div class="row g-4">

    {% for game in games %}

    <!-- GAME CARD -->
    <div class="col-md-6 col-lg-4">
        <div class="game-card">

            <!-- Image -->
            <div class="game-card-img">
                <img
                    src="{{ url_for('static', filename='placeholder_game.jpg') }}"
                    alt="{{ game.name }}">
            </div>

            <!-- Card body -->
            <div class="game-card-body">

                <h3 class="game-title">{{ game.name }}</h3>

                <span class="badge genre-badge genre-{{ game.genre | lower | replace(' ', '-') | replace('/', '') }}">
                    {{ game.genre }}
                </span>

                <ul class="game-meta">
                    <li>
                        <i class="bi bi-star-fill"></i>
                        <span>{{ game.rating }}</span>
                    </li>
                    <li>
                        <i class="bi bi-people-fill"></i>
                        <span>{{ game.ideal_participants_range }}</span>
                    </li>
                    <li>
                        <i class="bi bi-calendar-event"></i>
                        <span>{{ game.last_updated }}</span>
                    </li>
                </ul>

                <div class="game-card-actions">

                    <!-- EDIT BUTTON (MODAL) -->
                    <button
                        class="btn btn-sm btn-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#editGameModal{{ game.id }}">
                        Edit
                    </button>

                    <!-- DELETE -->
                    <form action="/delete_game/{{ game.id }}" method="POST"
                          onsubmit="return confirm('Are you sure you want to delete {{ game.name }}?');">
                        <button type="submit" class="btn btn-sm btn-outline-danger">
                            Remove
                        </button>
                    </form>

                </div>
            </div>
        </div>
    </div>
    <!-- END GAME CARD -->


    <!-- EDIT GAME MODAL -->
    <div class="modal fade" id="editGameModal{{ game.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Edit game</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form method="POST" action="/edit_game/{{ game.id }}">
                    <div class="modal-body">

                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text"
                                   name="game_name"
                                   class="form-control"
                                   value="{{ game.name }}"
                                   required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Genre</label>
                            <select name="genre" class="form-select" required>

                                {% set genres = [
                                    "Strategy", "Cooperative", "Party", "Card Game",
                                    "Family", "Abstract Strategy", "Thematic / Adventure",
                                    "Social Deduction / Bluffing", "Deck-building",
                                    "Trivia", "Educational", "War/Conflict"
                                ] %}

                                {% for genre in genres %}
                                <option value="{{ genre }}"
                                    {% if game.genre == genre %}selected{% endif %}>
                                    {{ genre }}
                                </option>
                                {% endfor %}

                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Rating (BGG)</label>
                            <input type="number"
                                   min="0"
                                   name="rating"
                                   class="form-control"
                                   value="{{ game.rating }}"
                                   required>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label class="form-label">Min players</label>
                                <input type="number"
                                       min="0"
                                       name="min_players"
                                       class="form-control"
                                       value="{{ game.min_players }}"
                                       required>
                            </div>

                            <div class="col">
                                <label class="form-label">Max players</label>
                                <input type="number"
                                       min="0"
                                       name="max_players"
                                       class="form-control"
                                       value="{{ game.max_players }}"
                                       required>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                            Cancel
                        </button>

                        <button type="submit" class="btn btn-primary">
                            Save changes
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
    <!-- END EDIT GAME MODAL -->

    {% endfor %}

</div>

<!-- ADD GAME MODAL -->
<div class="modal fade" id="addGameModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Add new game</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form method="POST" action="/add_game">
                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input
                            type="text"
                            name="game_name"
                            class="form-control"
                            required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Genre</label>
                        <select name="genre" class="form-select" required>
                            <option value="">Select genre</option>

                            {% set genres = [
                                "Strategy", "Cooperative", "Party", "Card Game",
                                "Family", "Abstract Strategy", "Thematic / Adventure",
                                "Social Deduction / Bluffing", "Deck-building",
                                "Trivia", "Educational", "War/Conflict"
                            ] %}

                            {% for genre in genres %}
                            <option value="{{ genre }}">{{ genre }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Rating (BGG)</label>
                        <input
                            type="number"
                            name="rating"
                            class="form-control"
                            required>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label class="form-label">Min players</label>
                            <input
                                type="number"
                                min="0"
                                name="min_players"
                                class="form-control"
                                required>
                        </div>

                        <div class="col">
                            <label class="form-label">Max players</label>
                            <input
                                type="number"
                                min="0"
                                name="max_players"
                                class="form-control"
                                required>
                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-bs-dismiss="modal">
                        Cancel
                    </button>

                    <button type="submit" class="btn btn-primary">
                        Save
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>
<!-- END ADD GAME MODAL -->

{% endblock %}